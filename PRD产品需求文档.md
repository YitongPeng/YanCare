# 燕斛堂养发小程序 - 产品需求文档 (PRD)

**更新日期**：2026年1月24日  
**产品负责人**：彭弋桐  
**文档状态**：已实现

---

## 目录

1. [产品概述](#1-产品概述)
2. [用户角色](#2-用户角色)
3. [功能架构](#3-功能架构)
4. [详细功能需求](#4-详细功能需求)
5. [页面结构](#5-页面结构)
6. [业务流程](#6-业务流程)
7. [数据结构](#7-数据结构)
8. [非功能需求](#8-非功能需求)
9. [版本规划](#9-版本规划)

---

## 1. 产品概述

### 1.1 产品背景

燕斛堂是一家专注于头皮与头发日常养护服务的连锁门店，目前拥有两家分店。为提升顾客体验和门店运营效率，需要开发一款微信小程序，实现在线预约、会员卡管理、智能咨询等功能。

### 1.2 产品定位

**燕斛堂养发小程序** 是一款面向养发馆顾客和员工的服务管理工具，提供：
- 顾客端：预约服务、查看会员卡、AI智能咨询
- 员工端：排班管理、开卡续卡、服务核销

### 1.3 产品目标

| 目标 | 衡量指标 |
|-----|---------|
| 提升工作效率 | 线上预约占比 > 60% |
| 提高顾客留存 | 会员续卡率 > 40% |
| 降低咨询成本 | AI回复解决率 > 70% |
| 优化员工管理 | 排班冲突率 < 5% |

### 1.4 目标用户

| 用户类型 | 特征 | 核心需求 |
|---------|-----|---------|
| 顾客 | 25-55岁，关注头发健康，有一定消费能力 | 便捷预约、了解服务、查看卡次 |
| 员工 | 养发师/理疗师 | 管理排班、记录业绩、服务核销 |
| 店长/管理员 | 门店负责人 | 查看数据、管理员工 |

---

## 2. 用户角色

### 2.1 角色定义

![image-20260127015601325](/Users/pengyitong/Library/Application Support/typora-user-images/image-20260127015601325.png)

### 2.2 角色权限矩阵

| 功能 | 顾客 | 员工 |
|-----|:----:|:----:|
| 查看门店信息 | ✅ | ✅ |
| 预约服务 | ✅ | ✅ |
| AI咨询 | ✅ | ✅ |
| 查看/绑定我的卡 | ✅ | ✅ |
| 管理排班 | ❌ | ✅ |
| 开卡/续卡 | ❌ | ✅ |
| 核销预约 | ❌ | ✅ |
| 查看业绩统计 | ❌ | ✅ |

### 2.3 登录方式

- **顾客**：微信一键登录（开发环境需输入姓名）
- **员工**：微信登录 + 员工密码验证

---

## 3. 功能架构

### 3.1 功能全景图

![image-20260127023604980](/Users/pengyitong/Library/Application Support/typora-user-images/image-20260127023604980.png)

### 3.2 核心功能列表

| 模块 | 功能 | 优先级 | 状态 |
|-----|------|:-----:|:----:|
| 登录 | 微信登录 | P0 | ✅ |
| 登录 | 角色选择（顾客/员工） | P0 | ✅ |
| 首页 | 门店展示 | P0 | ✅ |
| 首页 | 服务介绍 | P1 | ✅ |
| 首页 | 导航到店 | P1 | ✅ |
| 预约 | 多步骤预约流程 | P0 | ✅ |
| 预约 | 根据排班显示可选员工 | P0 | ✅ |
| AI | 智能问答 | P0 | ✅ |
| AI | RAG知识检索 | P0 | ✅ |
| 个人 | 查看我的卡 | P0 | ✅ |
| 个人 | 绑定手机号 | P1 | ✅ |
| 员工 | 排班管理 | P0 | ✅ |
| 员工 | 开卡/续卡 | P0 | ✅ |
| 员工 | 核销预约 | P0 | ✅ |
| 员工 | 业绩统计 | P1 | ✅ |

---

## 4. 详细功能需求

### 4.1 登录模块

#### 4.1.1 功能描述

用户打开小程序后，首先进入登录页面，选择身份（顾客/员工）后进行登录。

#### 4.1.2 业务规则

| 规则编号 | 规则描述 |
|---------|---------|
| LOGIN-001 | 顾客登录无需密码，直接微信授权 |
| LOGIN-002 | 员工登录需要输入员工密码（当前为：pytnb） |
| LOGIN-003 | 员工需输入姓名，用于排班和业绩记录 |
| LOGIN-004 | 登录成功后保存 token，7天有效 |
| LOGIN-005 | token 过期后自动跳转登录页 |

---

### 4.2 首页模块

#### 4.2.1 功能描述

展示门店信息、服务介绍和团队介绍，支持 Tab 切换。

门店介绍支持导航功能和距离判断

---

### 4.3 预约模块

#### 4.3.1 功能描述

顾客通过多步骤流程完成服务预约。

#### 4.3.2 预约流程

```
步骤1: 选择门店
    ↓
步骤2: 选择会员卡（有卡用户）/ 选择服务（无卡用户）
    ↓
步骤3: 选择具体服务类型
    ↓
步骤4: 选择日期
    ↓
步骤5: 选择时间段
    ↓
步骤6: 选择服务员工（根据排班自动筛选）
    ↓
步骤7: 确认预约
    ↓
完成: 显示预约成功
```

#### 4.3.3 业务规则

| 规则编号 | 规则描述 |
|---------|---------|
| APPT-001 | 只显示当前门店+当前日期+当前时段有排班的员工 |
| APPT-002 | 预约需选择会员卡（有卡用户），系统自动关联 |
| APPT-003 | 无卡用户可以预约体验（单次收费） |
| APPT-004 | 综合卡用户可选择多种服务 |
| APPT-005 | 预约状态：pending(待确认) → confirmed(已确认) → completed(已完成) |
| APPT-006 | 预约时记录 service_count，用于核销时扣卡次 |

#### 4.3.4 服务类型与扣次规则

| 卡类型 | 可选服务 | 扣次规则 |
|-------|---------|---------|
| 洗头卡 | 洗头 | 1次 |
| 泡头卡 | 泡头（含洗头） | 1次 |
| 养发卡（4种） | 养发 | 1次 |
| 综合卡 | 洗头/泡头/养发 | 选1个服务扣1次，选2个扣2次 |

---

### 4.4 AI咨询模块

#### 4.4.1 功能描述

基于 RAG（检索增强生成）技术的智能问答系统，回答用户关于养发的问题。

#### 4.4.2 技术架构

```
用户提问
    ↓
┌─────────────────┐
│  关键词匹配     │ ← 优先匹配预设问题
└────────┬────────┘
         ↓
┌─────────────────┐
│  向量检索       │ ← 语义相似度搜索
│  (ChromaDB)     │
└────────┬────────┘
         ↓
┌─────────────────┐
│  组装提示词     │ ← 系统提示 + 检索结果 + 用户问题
└────────┬────────┘
         ↓
┌─────────────────┐
│  DeepSeek API   │ ← 大语言模型生成回答
└────────┬────────┘
         ↓
返回回答
```

#### 4.4.3 知识库内容

| 文件                | 内容                           | 文档块数  |
| ------------------- | ------------------------------ | --------- |
| 1-常见问题FAQ.md    | 35 个问答对                    | 35        |
| 2-卡种介绍.md       | 7 种会员卡详情                 | 11        |
| 3-服务项目介绍.md   | 姜疗洗头、中药泡头、磁疗梳养发 | 5         |
| 4-产品介绍.md       | 5 种仁味康洗发水               | 10        |
| 5-门店信息.md       | 2 个门店地址电话               | 6         |
| 6-养发知识科普.md   | 头发健康、养护、误区           | 7         |
| 7-预约和使用指南.md | 预约方式、到店流程、会员卡使用 | 9         |
| **合计**            |                                | **83 块** |

#### 4.4.4 AI人设（**system prompt**）

```
名称：燕儿
角色：燕斛堂智能养护顾问
语气：亲切、专业、自然
规则：
- 基于知识库回答，不编造
- 回答简洁（100-200字）
- 适当反问引导对话
- 涉及医疗问题时，建议就医
```

---

### 4.5 个人中心模块

#### 4.5.1 功能描述

展示用户信息、会员卡列表，支持绑定手机号。

#### 4.5.2 手机号绑定逻辑

为防止重名的顾客

| 场景 | 处理方式 |
|-----|---------|
| 用户首次绑定手机号 | 直接保存 |
| 手机号已被员工端开卡占用 | 合并卡，原占位账户停用 |
| 手机号已被其他用户绑定 | 提示"该手机号已被使用" |

---

### 4.6 员工端模块

#### 4.6.1 功能描述

员工专属功能区，包含排班管理、开卡续卡、服务核销、业绩统计。

#### 4.6.2 排班管理

**添加排班流程：**
```
选择门店 → 选择日期 → 选择时间段 → 确认添加
```

**业务规则：**
| 规则编号 | 规则描述 |
|---------|---------|
| SCH-001 | 同一员工同一天可在不同门店有排班 |
| SCH-002 | 同一门店同一时段可有多名员工排班 |
| SCH-003 | 排班信息用于预约时筛选可选员工 |

#### 4.6.3 新客户开卡

**开卡流程：**
```
输入客户姓名 → 输入手机号 → 选择服务类型 → 自动匹配卡类型 → 确认开卡
```

**卡类型匹配规则：**
| 选择的服务 | 匹配的卡类型 |
|-----------|-------------|
| 只选洗头 | 洗头卡 |
| 只选泡头 或 洗头+泡头 | 泡头卡 |
| 只选养发 | 尊享/固本/深度/强效保养卡（4选1） |
| 洗头+养发 | 洗头卡 + 保养卡 |
| 泡头+养发 | 泡头卡 + 保养卡 + 综合卡 |
| 全选（洗+泡+养） | 综合卡 |

#### 4.6.5 老客户续卡

**续卡流程：**
```
搜索客户姓名 → 选择客户 → 选择要续的卡 → 选择续卡类型 → 确认续卡
```

#### 4.6.6 服务核销

**核销流程：**
```
查看今日预约列表 → 点击"核销" → 选择扣哪张卡 → 确认 → 扣减卡次
```

**业务规则：**
| 规则编号 | 规则描述 |
|---------|---------|
| CHK-001 | 核销时根据预约的 service_count 扣减卡次 |
| CHK-002 | 扣减后更新卡的 remaining_times |
| CHK-003 | 核销完成后预约状态变为 completed |
| CHK-004 | 记录到业绩统计 |

---

## 5. 页面结构

### 5.1 页面清单

| 页面路径 | 页面名称 | 所属端 |
|---------|---------|-------|
| pages/login/login | 登录页 | 公共 |
| pages/index/index | 首页 | 顾客 |
| pages/appointment/appointment | 预约 | 顾客 |
| pages/ai/ai | AI咨询 | 顾客 |
| pages/my/my | 我的 | 顾客 |
| pages/staff/index | 员工工作台 | 员工 |
| pages/staff/schedule | 添加排班 | 员工 |
| pages/staff/appointments | 今日预约 | 员工 |
| pages/staff/newcard | 新客户开卡 | 员工 |
| pages/staff/renew | 老客户续卡 | 员工 |

### 5.2 页面关系图

客户端：

![image-20260128233530459](/Users/pengyitong/Library/Application Support/typora-user-images/image-20260128233530459.png)

员工端：

![image-20260128233635343](/Users/pengyitong/Library/Application Support/typora-user-images/image-20260128233635343.png)

---

## 6. 业务流程

### 6.1 新客户全流程

![image-20260129113349776](/Users/pengyitong/Library/Application Support/typora-user-images/image-20260129113349776.png)



### 6.2 预约核销闭环

![image-20260129113522179](/Users/pengyitong/Library/Application Support/typora-user-images/image-20260129113522179.png)



---

## 7. 数据结构

### 7.1 数据库表设计

#### 7.1.1 用户表 (users)

| 字段 | 类型 | 说明 |
|-----|------|-----|
| id | INTEGER | 主键 |
| openid | VARCHAR | 微信OpenID，唯一 |
| nickname | VARCHAR | 昵称 |
| real_name | VARCHAR | 真实姓名 |
| phone | VARCHAR | 手机号 |
| role | VARCHAR | 角色：customer/staff |
| is_active | BOOLEAN | 是否激活 |
| created_at | DATETIME | 创建时间 |

#### 7.1.2 门店表 (stores)

| 字段 | 类型 | 说明 |
|-----|------|-----|
| id | INTEGER | 主键 |
| name | VARCHAR | 门店名称 |
| address | VARCHAR | 地址 |
| phone | VARCHAR | 电话 |
| latitude | FLOAT | 纬度 |
| longitude | FLOAT | 经度 |
| business_hours | VARCHAR | 营业时间 |

#### 7.1.3 卡类型表 (card_types)

| 字段 | 类型 | 说明 |
|-----|------|-----|
| id | INTEGER | 主键 |
| name | VARCHAR | 卡名称 |
| service_type | VARCHAR | 服务类型：wash/soak/care/combo |
| total_times | INTEGER | 总次数（-1表示无限） |
| valid_days | INTEGER | 有效天数 |
| price | DECIMAL | 价格 |

#### 7.1.4 用户卡表 (user_cards)

| 字段 | 类型 | 说明 |
|-----|------|-----|
| id | INTEGER | 主键 |
| user_id | INTEGER | 用户ID（外键） |
| card_type_id | INTEGER | 卡类型ID（外键） |
| remaining_times | INTEGER | 剩余次数 |
| expire_date | DATE | 过期日期 |
| created_at | DATETIME | 开卡时间 |

#### 7.1.5 排班表 (schedules)

| 字段 | 类型 | 说明 |
|-----|------|-----|
| id | INTEGER | 主键 |
| staff_id | INTEGER | 员工ID（外键） |
| store_id | INTEGER | 门店ID（外键） |
| date | DATE | 日期 |
| start_time | TIME | 开始时间 |
| end_time | TIME | 结束时间 |

#### 7.1.6 预约表 (appointments)

| 字段 | 类型 | 说明 |
|-----|------|-----|
| id | INTEGER | 主键 |
| user_id | INTEGER | 顾客ID（外键） |
| staff_id | INTEGER | 员工ID（外键） |
| store_id | INTEGER | 门店ID（外键） |
| user_card_id | INTEGER | 使用的卡ID（外键） |
| service_type | VARCHAR | 服务类型 |
| service_count | INTEGER | 服务数量（扣次用） |
| date | DATE | 预约日期 |
| time_slot | VARCHAR | 时间段 |
| status | VARCHAR | 状态：pending/confirmed/completed/cancelled |
| created_at | DATETIME | 创建时间 |

### 7.2 ER图

```
┌─────────────┐       ┌─────────────┐       ┌─────────────┐
│   users     │       │ user_cards  │       │ card_types  │
├─────────────┤       ├─────────────┤       ├─────────────┤
│ id (PK)     │←──┐   │ id (PK)     │   ┌──→│ id (PK)     │
│ openid      │   │   │ user_id(FK) │───┘   │ name        │
│ nickname    │   │   │ card_type_id│───────│ service_type│
│ phone       │   │   │ remaining   │       │ total_times │
│ role        │   │   │ expire_date │       │ valid_days  │
└─────────────┘   │   └─────────────┘       └─────────────┘
       │          │
       │          │   ┌─────────────┐       ┌─────────────┐
       │          │   │appointments │       │  schedules  │
       │          │   ├─────────────┤       ├─────────────┤
       │          └───│ user_id(FK) │       │ id (PK)     │
       │              │ staff_id(FK)│←──────│ staff_id(FK)│
       │              │ store_id(FK)│       │ store_id(FK)│
       └─────────────→│ user_card_id│       │ date        │
                      │ service_type│       │ time_slot   │
                      │ status      │       └─────────────┘
                      └─────────────┘
                             │
                             ↓
                      ┌─────────────┐
                      │   stores    │
                      ├─────────────┤
                      │ id (PK)     │
                      │ name        │
                      │ address     │
                      └─────────────┘
```

---

## 8. 非功能需求

### 8.1 性能需求

| 指标 | 要求 |
|-----|------|
| 页面加载时间 | < 2秒 |
| API响应时间 | < 500ms（AI除外） |
| AI响应时间 | < 10秒 |
| 并发用户数 | 支持 100 并发 |

### 8.2 安全需求

| 需求 | 实现方式 |
|-----|---------|
| 身份认证 | JWT Token，7天有效期 |
| 接口鉴权 | 除登录外，所有接口需验证 Token |
| 数据传输 | 生产环境强制 HTTPS |
| 敏感数据 | API密钥存储在环境变量，不入代码库 |

### 8.3 可用性需求

| 指标 | 要求 |
|-----|------|
| 系统可用性 | > 99% |
| 数据备份 | 每日自动备份 |
| 故障恢复 | < 4小时 |

### 8.4 兼容性需求

| 平台 | 版本要求 |
|-----|---------|
| 微信 | 基础库 >= 2.10.0 |
| iOS | >= 11.0 |
| Android | >= 5.0 |

---

## 9. 版本规划

### 9.1 V1.0（当前版本）- 基础功能

**已完成功能：**
- ✅ 微信登录（顾客/员工）
- ✅ 首页（服务介绍、门店列表）
- ✅ 预约功能（多步骤流程）
- ✅ AI智能问答（RAG + DeepSeek）
- ✅ 个人中心（我的卡、绑定手机）
- ✅ 员工端（排班、开卡、续卡、核销、业绩）

### 9.2 V1.1 - 体验优化（规划中）

**计划功能：**
- [ ] 预约提醒（微信消息通知）
- [ ] 历史预约记录查看
- [ ] 卡即将过期提醒
- [ ] AI对话历史保存
- [ ] 更多 FAQ 知识补充

### 9.3 V2.0 - 功能扩展（远期）

**计划功能：**
- [ ] 在线支付（需企业主体）
- [ ] 优惠券/活动
- [ ] 会员积分体系
- [ ] 数据分析看板
- [ ] 多门店管理后台

---

## 附录

### A. 卡种价格表

| 卡类型 | 价格 | 次数 | 有效期 | 服务类型 |
|-------|------|------|-------|---------|
| 洗头卡 | ¥1,000 | 50次 | 永久 | 洗头 |
| 泡头卡 | ¥1,800 | 30次 | 6个月 | 泡头 |
| 尊享保养卡 | ¥13,800 | 无限次 | 1年 | 养发 |
| 固本保养卡 | ¥5,000 | 60次 | 1.5年 | 养发 |
| 深度保养卡 | ¥6,000 | 100次 | 1年 | 养发 |
| 强效保养卡 | ¥9,000 | 180次 | 1年 | 养发 |
| 综合卡 | ¥6,000 | 100次 | 1年 | 洗/泡/养 |

### B. 营业信息

| 项目 | 内容 |
|-----|------|
| 营业时间 | 8:15 - 20:30 |
| 服务时长-洗头 | 约20分钟 |
| 服务时长-泡头 | 约45分钟 |
| 服务时长-养发 | 约50分钟 |
